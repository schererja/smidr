name: ci-toradex
description: "CI integration: Toradex layers + light recipe build"
yocto_series: kirkstone
base:
  provider: toradex
  machine: verdin-imx8mp
  distro: poky
  version: "6.0.0"
layers:
  - name: poky
    git: https://git.yoctoproject.org/poky
    branch: kirkstone
  - name: meta-openembedded
    git: https://github.com/openembedded/meta-openembedded
    branch: kirkstone
  - name: meta-freescale
    git: https://github.com/Freescale/meta-freescale.git
    branch: kirkstone
  - name: meta-freescale-3rdparty
    git: https://github.com/Freescale/meta-freescale-3rdparty.git
    branch: kirkstone
  - name: meta-toradex-bsp-common
    git: https://git.toradex.com/meta-toradex-bsp-common.git
  - name: meta-toradex-nxp
    git: https://git.toradex.com/meta-toradex-nxp.git
build:
  # Build a minimal image to exercise full deploy artifacts
  image: core-image-minimal
  machine: verdin-imx8mp
  bb_number_threads: 2
  parallel_make: 2
artifacts:
  - "*.rpm"
  - "*.ipk"
  - "*.deb"
  - "*.tar.bz2"
  - "*.log"
directories:
  downloads: ${YOCTO_DL_DIR:-~/.smidr/downloads}
  sstate: ${YOCTO_SSTATE_DIR:-~/.smidr/sstate}
  tmp: ${YOCTO_TMP_DIR:-~/.smidr/tmp}
  deploy: ${YOCTO_DEPLOY_DIR:-~/.smidr/deploy}
container:
  base_image: crops/yocto:ubuntu-22.04-builder
advanced:
  # Keep timeouts conservative; this job may run on a self-hosted runner with cached sstate
  build_timeout: 240 # minutes
  sstate_mirrors: ${YOCTO_SSTATE_MIRRORS:-file://.* file:///home/builder/sstate-cache/PATH}
  premirrors: ${YOCTO_PREMIRRORS:-}
  bb_no_network: ${YOCTO_BB_NO_NETWORK:-false}
  bb_fetch_premirroronly: ${YOCTO_BB_FETCH_PREMIRRORONLY:-false}
packages:
  classes: package_rpm
features:
  extra_image_features: ["debug-tweaks"]
