name: ci-smoke
description: "CI fast tiers: parse/fetch/sstate"
base:
  provider: custom
  machine: qemux86-64
  distro: poky
  version: "6.0.0"
layers:
  - name: poky
    git: https://git.yoctoproject.org/poky
    branch: kirkstone
  - name: meta-openembedded
    git: https://github.com/openembedded/meta-openembedded
    branch: kirkstone
build:
  image: core-image-minimal
  bb_number_threads: 8
  parallel_make: 8
directories:
  layers: ${YOCTO_LAYERS_DIR:-~/.smidr/layers}
  downloads: ${YOCTO_DL_DIR:-~/.smidr/downloads}
  sstate: ${YOCTO_SSTATE_DIR:-~/.smidr/sstate}
  tmp: ${YOCTO_TMP_DIR:-~/.smidr/tmp}
  deploy: ${YOCTO_DEPLOY_DIR:-~/.smidr/deploy}
container:
  base_image: crops/yocto:ubuntu-22.04-builder
advanced:
  bb_signature_handler: OEEquivHash
  conf_version: "2"
  # Optional: set via env to point to your mirror (example for documentation)
  # bb_hashserve: "auto"
  # Prefer SSTATE_MIRRORS for container builds; default to container bind mount path
  sstate_mirrors: ${YOCTO_SSTATE_MIRRORS:-file://.* file:///home/builder/sstate-cache/PATH}
  # Optionally accelerate fetches via premirror; point this to your artifact store
  premirrors: ${YOCTO_PREMIRRORS:-}
  # If your CI has no outbound network, set these
  bb_no_network: ${YOCTO_BB_NO_NETWORK:-false}
  bb_fetch_premirroronly: ${YOCTO_BB_FETCH_PREMIRRORONLY:-false}
packages:
  classes: package_ipk
features:
  extra_image_features: ["debug-tweaks"]