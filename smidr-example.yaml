# Smidr Build Configuration - Normalized Example
# This example shows all available configuration options

name: my-embedded-project
description: "Custom embedded Linux image with full configuration"

# Base system configuration
base:
  provider: toradex
  machine: verdin-imx8mp
  distro: tdx-xwayland
  version: "6.0.0"

# Layer configuration
layers:
  - name: meta-toradex-bsp-common
    git: https://git.toradex.com/meta-toradex-bsp-common
    branch: kirkstone-6.x.y
  - name: meta-mycompany
    path: ./layers/meta-mycompany

# Build configuration
build:
  image: core-image-weston
  machine: verdin-imx8mp  # Overrides base.machine
  extra_packages:
    - python3
    - nodejs
    - vim
    - htop
  parallel_make: 8
  bb_number_threads: 8

# Directory configuration (maps to DL_DIR, SSTATE_DIR, etc.)
directories:
  downloads: "${TOPDIR}/../downloads"
  sstate: "${TOPDIR}/../sstate-cache"
  tmp: "${TOPDIR}/tmp"
  deploy: "${TOPDIR}/deploy"

# Package management configuration
packages:
  classes: "package_rpm"  # package_rpm, package_deb, package_ipk

# Feature configuration
features:
  extra_image_features:
    - "debug-tweaks"
    - "package-management"
    - "tools-sdk"
  user_classes:
    - "buildstats"
  inherit_classes:
    - "rm_work"
    - "toradex-mirrors"
    - "toradex-sanity"

# Advanced configuration options
advanced:
  bb_hashserve: "auto"
  bb_signature_handler: "OEEquivHash"
  license_flags: "commercial"
  conf_version: "2"
  disk_monitoring: true
  qemu_sdl: true
  qemu_gtk: false
  accept_fsl_eula: true

# Output artifacts to extract
artifacts:
  - "*.wic"           # Disk images
  - "*.tar.bz2"       # Root filesystem archives
  - "*-sdk-*.sh"      # SDK installers

# Container configuration
container:
  base_image: "crops/yocto:ubuntu-22.04-builder"
  memory: "8g"
  cpu_count: 8

# Cache configuration
cache:
  downloads: ~/.smidr/downloads
  sstate: ~/.smidr/sstate-cache
  retention: 30
