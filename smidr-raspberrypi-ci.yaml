name: ci-raspberrypi
description: "CI integration: Raspberry Pi BSP layers"
yocto_series: kirkstone
base:
  provider: raspberrypi
  machine: raspberrypi4-64
  distro: poky
  version: "6.0.0"
layers:
  - name: poky
    git: https://git.yoctoproject.org/poky
    branch: kirkstone
  - name: meta-openembedded
    git: https://github.com/openembedded/meta-openembedded
    branch: kirkstone
  - name: meta-raspberrypi
    git: https://github.com/agherzan/meta-raspberrypi.git
    branch: kirkstone
build:
  image: core-image-minimal
  machine: raspberrypi4-64
  bb_number_threads: 8
  parallel_make: 8

artifacts:
  - "*.wic"
  - "*.wic.bz2"
  - "*.tar.bz2"
  - "*.manifest"
directories:
  layers: ${YOCTO_LAYERS_DIR:-~/.smidr/layers}
  downloads: ${YOCTO_DL_DIR:-~/.smidr/downloads}
  sstate: ${YOCTO_SSTATE_DIR:-~/.smidr/sstate}
  tmp: ${YOCTO_TMP_DIR:-~/.smidr/tmp}
  deploy: ${YOCTO_DEPLOY_DIR:-~/.smidr/deploy}
container:
  base_image: crops/yocto:ubuntu-22.04-builder
advanced:
  build_timeout: 240
  sstate_mirrors: ${YOCTO_SSTATE_MIRRORS:-file://.* file:///home/builder/sstate-cache/PATH}
packages:
  classes: package_ipk
features:
  extra_image_features: ["debug-tweaks"]
